(()=>{"use strict";var e={18(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.TraceDetailPanel=void 0;const i=r(t(398));class c{connectionId;traceId;connectionManager;static panels=new Map;panel;disposables=[];trace=null;constructor(e,n,t,s){this.connectionId=n,this.traceId=t,this.connectionManager=s,this.panel=e,this.panel.webview.html=this.getLoadingHtml(),this.panel.onDidDispose(()=>this.dispose(),null,this.disposables),this.panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this.disposables),this.loadTrace()}static show(e,n,t){const s=`${e}:${n.id}`,o=this.panels.get(s);if(o)return void o.panel.reveal();const a=i.window.createWebviewPanel("langfuseTraceDetail",`Trace: ${n.name||n.id.slice(0,8)}`,i.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0}),r=new c(a,e,n.id,t);this.panels.set(s,r)}async loadTrace(){const e=this.connectionManager.getClient(this.connectionId);if(e)try{this.trace=await e.getTrace(this.traceId),this.panel.webview.html=this.getHtml()}catch(e){this.panel.webview.html=this.getErrorHtml(e instanceof Error?e.message:"Failed to load trace")}else this.panel.webview.html=this.getErrorHtml("Not connected")}handleMessage(e){switch(e.command){case"openInBrowser":this.openInBrowser();break;case"refresh":this.loadTrace()}}openInBrowser(){const e=this.connectionManager.getConnections().find(e=>e.id===this.connectionId);if(e&&this.trace){const n=this.trace.projectId||"default",t=`${e.url}/project/${n}/traces/${this.trace.id}`;i.env.openExternal(i.Uri.parse(t))}}getLoadingHtml(){return"<!DOCTYPE html>\n<html><head><style>\nbody { display: flex; justify-content: center; align-items: center; height: 100vh; \n  font-family: var(--vscode-font-family); color: var(--vscode-foreground); }\n</style></head><body>Loading trace...</body></html>"}getErrorHtml(e){return`<!DOCTYPE html>\n<html><head><style>\nbody { display: flex; justify-content: center; align-items: center; height: 100vh;\n  font-family: var(--vscode-font-family); color: var(--vscode-errorForeground); }\n</style></head><body>Error: ${e}</body></html>`}getHtml(){if(!this.trace)return this.getErrorHtml("No trace data");const e=this.trace,n=e.observations||[],t=new Date(e.timestamp).getTime(),s=(((n.length>0?Math.max(...n.map(e=>new Date(e.endTime||e.startTime).getTime())):t)-t)/1e3).toFixed(2);return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <style>\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    body {\n      font-family: var(--vscode-font-family);\n      font-size: 13px;\n      color: var(--vscode-foreground);\n      background: var(--vscode-editor-background);\n      height: 100vh;\n      overflow: hidden;\n    }\n    .container { display: flex; height: 100vh; }\n    .sidebar {\n      width: 320px;\n      min-width: 280px;\n      border-right: 1px solid var(--vscode-panel-border);\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n    }\n    .sidebar-header {\n      padding: 12px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n      flex-shrink: 0;\n    }\n    .sidebar-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }\n    .sidebar-meta { font-size: 11px; color: var(--vscode-descriptionForeground); }\n    .tree { flex: 1; overflow-y: auto; padding: 8px 0; }\n    .tree-item { cursor: pointer; user-select: none; }\n    .tree-item-header {\n      display: flex;\n      align-items: center;\n      padding: 6px 12px;\n      gap: 6px;\n    }\n    .tree-item-header:hover { background: var(--vscode-list-hoverBackground); }\n    .tree-item.selected > .tree-item-header {\n      background: var(--vscode-list-activeSelectionBackground);\n      color: var(--vscode-list-activeSelectionForeground);\n    }\n    .tree-chevron {\n      width: 16px;\n      text-align: center;\n      font-size: 10px;\n      color: var(--vscode-descriptionForeground);\n      flex-shrink: 0;\n      transition: transform 0.15s;\n    }\n    .tree-icon {\n      width: 18px;\n      height: 18px;\n      border-radius: 3px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      flex-shrink: 0;\n    }\n    .tree-icon.trace { background: #6366f1; color: white; }\n    .tree-icon.span { background: #22c55e; color: white; }\n    .tree-icon.generation { background: #3b82f6; color: white; }\n    .tree-icon.event { background: #f59e0b; color: white; }\n    .tree-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n    .tree-badge {\n      padding: 1px 5px;\n      border-radius: 3px;\n      font-size: 10px;\n      font-weight: 600;\n      flex-shrink: 0;\n    }\n    .tree-badge.error { background: #ef4444; color: white; }\n    .tree-badge.warning { background: #f59e0b; color: white; }\n    .tree-duration { font-size: 11px; color: var(--vscode-descriptionForeground); flex-shrink: 0; }\n    .tree-children { display: none; }\n    .tree-item.expanded > .tree-children { display: block; }\n    .tree-item.expanded > .tree-item-header > .tree-chevron { transform: rotate(90deg); }\n    .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }\n    .main-header {\n      padding: 12px 16px;\n      border-bottom: 1px solid var(--vscode-panel-border);\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      flex-shrink: 0;\n    }\n    .main-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; }\n    .main-subtitle { font-size: 11px; color: var(--vscode-descriptionForeground); }\n    .badges { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }\n    .badge {\n      padding: 3px 8px;\n      border-radius: 4px;\n      font-size: 11px;\n      background: var(--vscode-badge-background);\n      color: var(--vscode-badge-foreground);\n    }\n    .actions { display: flex; gap: 8px; }\n    .btn {\n      padding: 5px 10px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      background: var(--vscode-button-secondaryBackground);\n      color: var(--vscode-button-secondaryForeground);\n    }\n    .btn:hover { background: var(--vscode-button-secondaryHoverBackground); }\n    .btn-primary { background: var(--vscode-button-background); color: var(--vscode-button-foreground); }\n    .btn-primary:hover { background: var(--vscode-button-hoverBackground); }\n    .main-content { flex: 1; overflow-y: auto; padding: 16px; }\n    \n    .section { margin-bottom: 16px; border: 1px solid var(--vscode-panel-border); border-radius: 6px; overflow: hidden; }\n    .section-header {\n      font-weight: 600;\n      font-size: 13px;\n      padding: 10px 12px;\n      background: var(--vscode-sideBarSectionHeader-background);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      user-select: none;\n    }\n    .section-header:hover { background: var(--vscode-list-hoverBackground); }\n    .section-chevron {\n      font-size: 10px;\n      transition: transform 0.15s;\n      color: var(--vscode-descriptionForeground);\n    }\n    .section.collapsed .section-chevron { transform: rotate(-90deg); }\n    .section.collapsed .section-content { display: none; }\n    .section-content {\n      padding: 12px;\n      background: var(--vscode-textCodeBlock-background);\n    }\n    .empty { color: var(--vscode-descriptionForeground); font-style: italic; }\n    \n    .model-info {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n      gap: 12px;\n      margin-bottom: 16px;\n    }\n    .model-info-item { background: var(--vscode-textCodeBlock-background); padding: 10px; border-radius: 6px; }\n    .model-info-label { font-size: 10px; color: var(--vscode-descriptionForeground); text-transform: uppercase; margin-bottom: 4px; }\n    .model-info-value { font-weight: 500; }\n    \n    .depth-0 { padding-left: 12px; }\n    .depth-1 { padding-left: 32px; }\n    .depth-2 { padding-left: 52px; }\n    .depth-3 { padding-left: 72px; }\n    .depth-4 { padding-left: 92px; }\n    .depth-5 { padding-left: 112px; }\n    \n    .json-tree { font-family: var(--vscode-editor-font-family); font-size: 12px; line-height: 1.6; }\n    .json-node { }\n    .json-key { color: #9cdcfe; }\n    .json-string { color: #ce9178; }\n    .json-number { color: #b5cea8; }\n    .json-boolean { color: #569cd6; }\n    .json-null { color: #569cd6; }\n    .json-bracket { color: var(--vscode-descriptionForeground); }\n    .json-toggle {\n      cursor: pointer;\n      user-select: none;\n      display: inline-block;\n      width: 14px;\n      text-align: center;\n      color: var(--vscode-descriptionForeground);\n      font-size: 10px;\n    }\n    .json-toggle:hover { color: var(--vscode-foreground); }\n    .json-collapsed > .json-children { display: none; }\n    .json-collapsed > .json-toggle { transform: rotate(-90deg); display: inline-block; }\n    .json-ellipsis { color: var(--vscode-descriptionForeground); cursor: pointer; }\n    .json-children { margin-left: 16px; }\n    .json-item-count { color: var(--vscode-descriptionForeground); font-size: 11px; margin-left: 4px; }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <div class="sidebar">\n      <div class="sidebar-header">\n        <div class="sidebar-title">${this.escapeHtml(e.name||"Unnamed Trace")}</div>\n        <div class="sidebar-meta">${n.length} observations · ${s}s</div>\n      </div>\n      <div class="tree">\n        ${this.renderTreeItem("trace",e.id,e.name||"Trace",s+"s",null,0,!0,this.buildObservationTree(n))}\n      </div>\n    </div>\n    <div class="main">\n      <div class="main-header" id="detail-header">\n        <div>\n          <div class="main-title" id="detail-title">${this.escapeHtml(e.name||"Trace")}</div>\n          <div class="main-subtitle" id="detail-subtitle">${new Date(e.timestamp).toLocaleString()}</div>\n          <div class="badges" id="detail-badges">\n            ${e.tags?.map(e=>`<span class="badge">${this.escapeHtml(e)}</span>`).join("")||""}\n          </div>\n        </div>\n        <div class="actions">\n          <button class="btn" onclick="refresh()">↻ Refresh</button>\n          <button class="btn btn-primary" onclick="openInBrowser()">↗ Open in Langfuse</button>\n        </div>\n      </div>\n      <div class="main-content" id="detail-content">\n        ${this.renderDetailContent("trace",e)}\n      </div>\n    </div>\n  </div>\n\n  <script>\n    const vscode = acquireVsCodeApi();\n    const traceData = ${JSON.stringify(e)};\n    const observations = ${JSON.stringify(n)};\n    const obsMap = new Map(observations.map(o => [o.id, o]));\n\n    function refresh() { vscode.postMessage({ command: 'refresh' }); }\n    function openInBrowser() { vscode.postMessage({ command: 'openInBrowser' }); }\n\n    function toggleTree(el, e) {\n      e.stopPropagation();\n      el.closest('.tree-item').classList.toggle('expanded');\n    }\n\n    function toggleSection(el) {\n      el.closest('.section').classList.toggle('collapsed');\n    }\n\n    function toggleJson(el, e) {\n      e.stopPropagation();\n      el.closest('.json-node').classList.toggle('json-collapsed');\n    }\n\n    function selectItem(type, id) {\n      document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('selected'));\n      const item = document.querySelector('[data-id="' + id + '"]');\n      if (item) item.classList.add('selected');\n\n      if (type === 'trace') {\n        showTraceDetail();\n      } else {\n        const obs = obsMap.get(id);\n        if (obs) showObservationDetail(obs);\n      }\n    }\n\n    function showTraceDetail() {\n      document.getElementById('detail-title').textContent = traceData.name || 'Trace';\n      document.getElementById('detail-subtitle').textContent = new Date(traceData.timestamp).toLocaleString();\n      document.getElementById('detail-badges').innerHTML = (traceData.tags || [])\n        .map(t => '<span class="badge">' + escapeHtml(t) + '</span>').join('');\n      document.getElementById('detail-content').innerHTML = renderContent(traceData.input, traceData.output, traceData.metadata);\n    }\n\n    function showObservationDetail(obs) {\n      document.getElementById('detail-title').textContent = obs.name || obs.type;\n      document.getElementById('detail-subtitle').textContent = new Date(obs.startTime).toLocaleString();\n      \n      const duration = obs.endTime \n        ? ((new Date(obs.endTime) - new Date(obs.startTime)) / 1000).toFixed(2)\n        : null;\n      \n      let badges = '<span class="badge">' + obs.type + '</span>';\n      if (duration) badges += '<span class="badge">Latency: ' + duration + 's</span>';\n      if (obs.model) badges += '<span class="badge">Model: ' + escapeHtml(obs.model) + '</span>';\n      if (obs.usage) {\n        const tokens = (obs.usage.input || 0) + (obs.usage.output || 0);\n        badges += '<span class="badge">' + tokens + ' tokens</span>';\n      }\n      if (obs.costDetails) {\n        const cost = Object.values(obs.costDetails).reduce((a, b) => a + b, 0);\n        if (cost > 0) badges += '<span class="badge">$' + cost.toFixed(6) + '</span>';\n      }\n      if (obs.level && obs.level !== 'DEFAULT') {\n        badges += '<span class="badge" style="background:#ef4444;color:white">' + obs.level + '</span>';\n      }\n      document.getElementById('detail-badges').innerHTML = badges;\n\n      let html = '';\n      if (obs.model || obs.usage) {\n        html += '<div class="model-info">';\n        if (obs.model) html += '<div class="model-info-item"><div class="model-info-label">Model</div><div class="model-info-value">' + escapeHtml(obs.model) + '</div></div>';\n        if (obs.usage) {\n          html += '<div class="model-info-item"><div class="model-info-label">Input Tokens</div><div class="model-info-value">' + (obs.usage.input || 0) + '</div></div>';\n          html += '<div class="model-info-item"><div class="model-info-label">Output Tokens</div><div class="model-info-value">' + (obs.usage.output || 0) + '</div></div>';\n        }\n        if (duration) html += '<div class="model-info-item"><div class="model-info-label">Duration</div><div class="model-info-value">' + duration + 's</div></div>';\n        if (obs.costDetails) {\n          const cost = Object.values(obs.costDetails).reduce((a, b) => a + b, 0);\n          html += '<div class="model-info-item"><div class="model-info-label">Cost</div><div class="model-info-value">$' + cost.toFixed(6) + '</div></div>';\n        }\n        html += '</div>';\n      }\n      html += renderContent(obs.input, obs.output, obs.metadata);\n      document.getElementById('detail-content').innerHTML = html;\n    }\n\n    function renderContent(input, output, metadata) {\n      let html = '';\n      html += renderSection('Input', input);\n      html += renderSection('Output', output);\n      if (metadata && Object.keys(metadata).length > 0) {\n        html += renderSection('Metadata', metadata);\n      }\n      return html;\n    }\n\n    function renderSection(title, data) {\n      const hasData = data !== null && data !== undefined;\n      return '<div class="section">' +\n        '<div class="section-header" onclick="toggleSection(this)">' +\n          '<span class="section-chevron">▼</span>' +\n          '<span>' + title + '</span>' +\n        '</div>' +\n        '<div class="section-content">' +\n          (hasData ? '<div class="json-tree">' + renderJsonTree(data, 0) + '</div>' : '<div class="empty">No ' + title.toLowerCase() + '</div>') +\n        '</div>' +\n      '</div>';\n    }\n\n    function renderJsonTree(value, depth) {\n      if (value === null) return '<span class="json-null">null</span>';\n      if (value === undefined) return '<span class="json-null">undefined</span>';\n      \n      const type = typeof value;\n      if (type === 'string') {\n        const escaped = escapeHtml(value);\n        if (value.length > 500) {\n          return '<span class="json-string">"' + escaped.slice(0, 500) + '..."</span>';\n        }\n        return '<span class="json-string">"' + escaped + '"</span>';\n      }\n      if (type === 'number') return '<span class="json-number">' + value + '</span>';\n      if (type === 'boolean') return '<span class="json-boolean">' + value + '</span>';\n      \n      if (Array.isArray(value)) {\n        if (value.length === 0) return '<span class="json-bracket">[]</span>';\n        const collapsed = depth > 1 ? ' json-collapsed' : '';\n        let html = '<span class="json-node' + collapsed + '">';\n        html += '<span class="json-toggle" onclick="toggleJson(this, event)">▼</span>';\n        html += '<span class="json-bracket">[</span>';\n        html += '<span class="json-item-count">' + value.length + ' items</span>';\n        html += '<span class="json-children">';\n        value.forEach((item, i) => {\n          html += '<div>' + renderJsonTree(item, depth + 1);\n          if (i < value.length - 1) html += ',';\n          html += '</div>';\n        });\n        html += '</span>';\n        html += '<span class="json-bracket">]</span>';\n        html += '</span>';\n        return html;\n      }\n      \n      if (type === 'object') {\n        const keys = Object.keys(value);\n        if (keys.length === 0) return '<span class="json-bracket">{}</span>';\n        const collapsed = depth > 1 ? ' json-collapsed' : '';\n        let html = '<span class="json-node' + collapsed + '">';\n        html += '<span class="json-toggle" onclick="toggleJson(this, event)">▼</span>';\n        html += '<span class="json-bracket">{</span>';\n        html += '<span class="json-item-count">' + keys.length + ' keys</span>';\n        html += '<span class="json-children">';\n        keys.forEach((key, i) => {\n          html += '<div><span class="json-key">"' + escapeHtml(key) + '"</span>: ' + renderJsonTree(value[key], depth + 1);\n          if (i < keys.length - 1) html += ',';\n          html += '</div>';\n        });\n        html += '</span>';\n        html += '<span class="json-bracket">}</span>';\n        html += '</span>';\n        return html;\n      }\n      \n      return '<span>' + escapeHtml(String(value)) + '</span>';\n    }\n\n    function escapeHtml(str) {\n      if (!str) return '';\n      return String(str)\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/"/g, '&quot;');\n    }\n\n    document.querySelector('.tree-item')?.classList.add('selected');\n  <\/script>\n</body>\n</html>`}buildObservationTree(e){const n=new Map;return n.set(null,[]),e.forEach(e=>{const t=e.parentObservationId||null;n.has(t)||n.set(t,[]),n.get(t).push(e)}),n.forEach(e=>{e.sort((e,n)=>new Date(e.startTime).getTime()-new Date(n.startTime).getTime())}),n}renderTreeItem(e,n,t,s,o,a,r,i){const c=r?i.get(null)||[]:i.get(n)||[],l=c.length>0,d=o?.toLowerCase(),u="error"===d,p="warning"===d;let h="";if(l){h='<div class="tree-children">';for(const e of c){const n=e.endTime?((new Date(e.endTime).getTime()-new Date(e.startTime).getTime())/1e3).toFixed(2)+"s":"";h+=this.renderTreeItem(e.type.toLowerCase(),e.id,e.name||e.type,n,e.level,a+1,!1,i)}h+="</div>"}return`\n      <div class="tree-item${l?" expanded":""}" data-id="${n}">\n        <div class="tree-item-header depth-${Math.min(a,5)}" onclick="selectItem('${e}', '${n}')">\n          <span class="tree-chevron" onclick="toggleTree(this, event)">${l?"▶":""}</span>\n          <span class="tree-icon ${e}">${this.getTypeIcon(e)}</span>\n          <span class="tree-name">${this.escapeHtml(t)}</span>\n          ${u?'<span class="tree-badge error">ERROR</span>':""}\n          ${p?'<span class="tree-badge warning">WARN</span>':""}\n          <span class="tree-duration">${s}</span>\n        </div>\n        ${h}\n      </div>\n    `}getTypeIcon(e){switch(e){case"trace":return"⊙";case"span":return"↔";case"generation":return"✦";case"event":return"⚡";default:return"○"}}renderDetailContent(e,n){return`\n      ${this.renderSection("Input",n.input)}\n      ${this.renderSection("Output",n.output)}\n      ${n.metadata&&Object.keys(n.metadata).length>0?this.renderSection("Metadata",n.metadata):""}\n    `}renderSection(e,n){return`<div class="section">\n      <div class="section-header" onclick="toggleSection(this)">\n        <span class="section-chevron">▼</span>\n        <span>${e}</span>\n      </div>\n      <div class="section-content">\n        ${null!=n?`<div class="json-tree">${this.renderJsonTree(n,0)}</div>`:`<div class="empty">No ${e.toLowerCase()}</div>`}\n      </div>\n    </div>`}renderJsonTree(e,n){if(null===e)return'<span class="json-null">null</span>';if(void 0===e)return'<span class="json-null">undefined</span>';const t=typeof e;if("string"===t){const n=this.escapeHtml(e);return e.length>500?`<span class="json-string">"${n.slice(0,500)}..."</span>`:`<span class="json-string">"${n}"</span>`}if("number"===t)return`<span class="json-number">${e}</span>`;if("boolean"===t)return`<span class="json-boolean">${e}</span>`;if(Array.isArray(e)){if(0===e.length)return'<span class="json-bracket">[]</span>';let t=`<span class="json-node${n>1?" json-collapsed":""}">`;return t+='<span class="json-toggle" onclick="toggleJson(this, event)">▼</span>',t+='<span class="json-bracket">[</span>',t+=`<span class="json-item-count">${e.length} items</span>`,t+='<span class="json-children">',e.forEach((s,o)=>{t+=`<div>${this.renderJsonTree(s,n+1)}${o<e.length-1?",":""}</div>`}),t+="</span>",t+='<span class="json-bracket">]</span></span>',t}if("object"===t){const t=Object.keys(e);if(0===t.length)return'<span class="json-bracket">{}</span>';let s=`<span class="json-node${n>1?" json-collapsed":""}">`;return s+='<span class="json-toggle" onclick="toggleJson(this, event)">▼</span>',s+='<span class="json-bracket">{</span>',s+=`<span class="json-item-count">${t.length} keys</span>`,s+='<span class="json-children">',t.forEach((o,a)=>{s+=`<div><span class="json-key">"${this.escapeHtml(o)}"</span>: ${this.renderJsonTree(e[o],n+1)}${a<t.length-1?",":""}</div>`}),s+="</span>",s+='<span class="json-bracket">}</span></span>',s}return`<span>${this.escapeHtml(String(e))}</span>`}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}dispose(){const e=`${this.connectionId}:${this.traceId}`;c.panels.delete(e),this.disposables.forEach(e=>e.dispose())}}n.TraceDetailPanel=c},32(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.LangfuseTreeProvider=void 0;const i=r(t(398)),c=t(185),l=18e5;function d(e,n){const t=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`${t(e)} - ${t(n)}`}n.LangfuseTreeProvider=class{connectionManager;_onDidChangeTreeData=new i.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;tracesCache=new Map;observationsCache=new Map;searchQuery;constructor(e){this.connectionManager=e,e.onDidChange(()=>this.refresh())}refresh(){this.tracesCache.clear(),this.observationsCache.clear(),this._onDidChangeTreeData.fire(void 0)}setSearchQuery(e){this.searchQuery=e,this.refresh()}getSearchQuery(){return this.searchQuery}clearSearch(){this.searchQuery=void 0,this.refresh()}getTreeItem(e){return e}async getChildren(e){return e?e instanceof c.ConnectionItem?this.getTraceItems(e.config.id):e instanceof c.TraceItem?this.getObservationItems(e.connectionId,e.trace.id,null):e instanceof c.ObservationItem?this.getObservationItems(e.connectionId,e.traceId,e.observation.id):[]:this.getConnectionItems()}getConnectionItems(){const e=this.connectionManager.getConnections();return 0===e.length?[new c.MessageItem("No connections. Click + to add.","info")]:e.map(e=>new c.ConnectionItem(e,this.connectionManager.isConnected(e.id)))}async getTraceItems(e){if(!this.connectionManager.isConnected(e))try{await this.connectionManager.connect(e)}catch(e){const n=e instanceof Error?e.message:"Connection failed";return[new c.MessageItem(`Error: ${n}`,"error")]}const n=this.connectionManager.getClient(e);if(!n)return[new c.MessageItem("Client not available","error")];try{let t=this.tracesCache.get(e);const s=await n.getProjectId();if(!t){const o=new Date,a=new Date(o.getTime()-l);t={traces:(await n.getTraces({fromTimestamp:a.toISOString(),toTimestamp:o.toISOString(),name:this.searchQuery},1,100)).data.map(e=>({...e,projectId:s||void 0})),newestTimestamp:o,oldestTimestamp:a,hasMore:!0},this.tracesCache.set(e,t)}return this.buildTraceTreeItems(e,t,n.baseUrl)}catch(e){const n=e instanceof Error?e.message:"Unknown error";return[new c.MessageItem(`Error: ${n}`,"error")]}}buildTraceTreeItems(e,n,t){const s=[];if(0===n.traces.length)s.push(new c.MessageItem("No traces in this time window","info"));else{const o=[...n.traces].sort((e,n)=>new Date(n.timestamp).getTime()-new Date(e.timestamp).getTime());for(const n of o)s.push(new c.TraceItem(n,e,t,!0))}if(n.hasMore){const t=n.oldestTimestamp,o=new Date(t.getTime()-l);s.push(new c.LoadOlderItem(e,o,t))}return s}async loadOlderTraces(e,n,t){const s=this.connectionManager.getClient(e);if(!s)return;const o=this.tracesCache.get(e);if(o)try{await i.window.withProgress({location:i.ProgressLocation.Notification,title:`Loading traces from ${d(n,t)}...`,cancellable:!1},async()=>{const e=await s.getProjectId(),a=(await s.getTraces({fromTimestamp:n.toISOString(),toTimestamp:t.toISOString(),name:this.searchQuery},1,100)).data.map(n=>({...n,projectId:e||void 0}));o.traces.push(...a),o.oldestTimestamp=n;const r=new Date(Date.now()-864e5);o.hasMore=n>r,this._onDidChangeTreeData.fire(void 0)})}catch(e){i.window.showErrorMessage(`Failed to load older traces: ${e instanceof Error?e.message:"Unknown error"}`)}}async getObservationItems(e,n,t){const s=`${e}:${n}`;let o=this.observationsCache.get(s);if(!o){const t=this.connectionManager.getClient(e);if(!t)return[new c.MessageItem("Client not available","error")];try{const e=await t.getTrace(n);o=e.observations||[],this.observationsCache.set(s,o)}catch(e){const n=e instanceof Error?e.message:"Unknown error";return[new c.MessageItem(`Error: ${n}`,"error")]}}const a=o.filter(e=>e.parentObservationId===t);return 0===a.length?null===t?[new c.MessageItem("No observations","info")]:[]:a.sort((e,n)=>new Date(e.startTime).getTime()-new Date(n.startTime).getTime()).map(t=>{const s=o.filter(e=>e.parentObservationId===t.id).length;return new c.ObservationItem(t,n,e,s)})}}},102(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionFormPanel=void 0;const i=r(t(398)),c=t(618);class l{extensionUri;existingConfig;onSave;static panels=new Map;panel;disposables=[];constructor(e,n,t,s){this.extensionUri=n,this.existingConfig=t,this.onSave=s,this.panel=e,this.panel.webview.html=this.getHtml(),this.panel.onDidDispose(()=>this.dispose(),null,this.disposables),this.panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this.disposables)}static show(e,n,t){const s=n?.id||"new",o=this.panels.get(s);if(o)return void o.panel.reveal();const a=i.window.createWebviewPanel("langfuseConnectionForm",n?`Edit: ${n.name}`:"New Langfuse Connection",i.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0}),r=new l(a,e,n,t);this.panels.set(s,r)}async handleMessage(e){switch(e.command){case"save":await this.handleSave(e);break;case"test":await this.handleTest(e);break;case"cancel":this.panel.dispose()}}async handleSave(e){const n={id:this.existingConfig?.id||crypto.randomUUID(),name:e.name,url:e.url.replace(/\/$/,""),publicKey:e.publicKey};try{await this.onSave(n,e.secretKey),this.panel.dispose()}catch(e){this.postMessage({command:"error",message:e instanceof Error?e.message:"Failed to save connection"})}}async handleTest(e){this.postMessage({command:"testing"});try{const n=new c.LangfuseClient(e.url.replace(/\/$/,""),e.publicKey,e.secretKey),t=await n.healthCheck();this.postMessage({command:"testResult",success:t,message:t?"Connection successful!":"Connection failed"})}catch(e){this.postMessage({command:"testResult",success:!1,message:e instanceof Error?e.message:"Connection failed"})}}postMessage(e){this.panel.webview.postMessage(e)}getHtml(){const e=this.existingConfig;return`<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <style>\n    body {\n      font-family: var(--vscode-font-family);\n      padding: 20px;\n      color: var(--vscode-foreground);\n      background: var(--vscode-editor-background);\n    }\n    .form-group {\n      margin-bottom: 16px;\n    }\n    label {\n      display: block;\n      margin-bottom: 4px;\n      font-weight: 500;\n    }\n    input {\n      width: 100%;\n      padding: 8px;\n      border: 1px solid var(--vscode-input-border);\n      background: var(--vscode-input-background);\n      color: var(--vscode-input-foreground);\n      border-radius: 4px;\n      box-sizing: border-box;\n    }\n    input:focus {\n      outline: 1px solid var(--vscode-focusBorder);\n    }\n    .hint {\n      font-size: 12px;\n      color: var(--vscode-descriptionForeground);\n      margin-top: 4px;\n    }\n    .buttons {\n      display: flex;\n      gap: 8px;\n      margin-top: 24px;\n    }\n    button {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 13px;\n    }\n    .primary {\n      background: var(--vscode-button-background);\n      color: var(--vscode-button-foreground);\n    }\n    .primary:hover {\n      background: var(--vscode-button-hoverBackground);\n    }\n    .secondary {\n      background: var(--vscode-button-secondaryBackground);\n      color: var(--vscode-button-secondaryForeground);\n    }\n    .message {\n      padding: 8px 12px;\n      border-radius: 4px;\n      margin-top: 16px;\n      display: none;\n    }\n    .message.success {\n      background: var(--vscode-testing-iconPassed);\n      color: white;\n      display: block;\n    }\n    .message.error {\n      background: var(--vscode-testing-iconFailed);\n      color: white;\n      display: block;\n    }\n    .message.testing {\n      background: var(--vscode-button-secondaryBackground);\n      display: block;\n    }\n  </style>\n</head>\n<body>\n  <h2>${e?"Edit Connection":"New Connection"}</h2>\n  \n  <div class="form-group">\n    <label for="name">Connection Name</label>\n    <input type="text" id="name" value="${e?.name||""}" placeholder="My Langfuse Project">\n  </div>\n\n  <div class="form-group">\n    <label for="url">Langfuse URL</label>\n    <input type="text" id="url" value="${e?.url||"https://cloud.langfuse.com"}" placeholder="https://cloud.langfuse.com">\n    <div class="hint">Use https://cloud.langfuse.com for cloud, or your self-hosted URL</div>\n  </div>\n\n  <div class="form-group">\n    <label for="publicKey">Public Key</label>\n    <input type="text" id="publicKey" value="${e?.publicKey||""}" placeholder="pk-lf-...">\n  </div>\n\n  <div class="form-group">\n    <label for="secretKey">Secret Key</label>\n    <input type="password" id="secretKey" placeholder="sk-lf-...">\n    <div class="hint">${e?"Leave empty to keep existing key":"Your secret key is stored securely"}</div>\n  </div>\n\n  <div class="buttons">\n    <button class="primary" onclick="save()">Save</button>\n    <button class="secondary" onclick="test()">Test Connection</button>\n    <button class="secondary" onclick="cancel()">Cancel</button>\n  </div>\n\n  <div id="message" class="message"></div>\n\n  <script>\n    const vscode = acquireVsCodeApi();\n\n    function save() {\n      vscode.postMessage({\n        command: 'save',\n        name: document.getElementById('name').value,\n        url: document.getElementById('url').value,\n        publicKey: document.getElementById('publicKey').value,\n        secretKey: document.getElementById('secretKey').value\n      });\n    }\n\n    function test() {\n      vscode.postMessage({\n        command: 'test',\n        url: document.getElementById('url').value,\n        publicKey: document.getElementById('publicKey').value,\n        secretKey: document.getElementById('secretKey').value\n      });\n    }\n\n    function cancel() {\n      vscode.postMessage({ command: 'cancel' });\n    }\n\n    window.addEventListener('message', event => {\n      const msg = event.data;\n      const el = document.getElementById('message');\n      \n      if (msg.command === 'testing') {\n        el.className = 'message testing';\n        el.textContent = 'Testing connection...';\n      } else if (msg.command === 'testResult') {\n        el.className = 'message ' + (msg.success ? 'success' : 'error');\n        el.textContent = msg.message;\n      } else if (msg.command === 'error') {\n        el.className = 'message error';\n        el.textContent = msg.message;\n      }\n    });\n  <\/script>\n</body>\n</html>`}dispose(){const e=this.existingConfig?.id||"new";l.panels.delete(e),this.disposables.forEach(e=>e.dispose())}}n.ConnectionFormPanel=l},143(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionStorage=void 0;const t="langfusecode.connections";n.ConnectionStorage=class{context;constructor(e){this.context=e}getConnections(){return this.context.globalState.get(t)||[]}async saveConnections(e){await this.context.globalState.update(t,e)}async addConnection(e){const n=this.getConnections();n.push(e),await this.saveConnections(n)}async updateConnection(e){const n=this.getConnections(),t=n.findIndex(n=>n.id===e.id);-1!==t&&(n[t]=e,await this.saveConnections(n))}async removeConnection(e){const n=this.getConnections().filter(n=>n.id!==e);await this.saveConnections(n)}async getSecretKey(e){return this.context.secrets.get(`langfusecode.secret.${e}`)}async setSecretKey(e,n){await this.context.secrets.store(`langfusecode.secret.${e}`,n)}async deleteSecretKey(e){await this.context.secrets.delete(`langfusecode.secret.${e}`)}}},185(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MessageItem=n.LoadOlderItem=n.ObservationItem=n.TraceItem=n.ConnectionItem=void 0;const i=r(t(398));class c extends i.TreeItem{config;isConnected;constructor(e,n){super(e.name,i.TreeItemCollapsibleState.Collapsed),this.config=e,this.isConnected=n,this.contextValue=n?"connection-connected":"connection-disconnected",this.iconPath=new i.ThemeIcon(n?"plug":"debug-disconnect"),this.description=new URL(e.url).host,this.tooltip=`${e.name}\n${e.url}\nStatus: ${n?"Connected":"Disconnected"}`}}n.ConnectionItem=c;class l extends i.TreeItem{trace;connectionId;baseUrl;constructor(e,n,t,s){super(e.name||e.id.slice(0,8),s?i.TreeItemCollapsibleState.Collapsed:i.TreeItemCollapsibleState.None),this.trace=e,this.connectionId=n,this.baseUrl=t,this.contextValue="trace",this.iconPath=new i.ThemeIcon("symbol-event"),this.description=function(e){const n=new Date(e),t=(new Date).getTime()-n.getTime(),s=Math.floor(t/6e4),o=Math.floor(s/60),a=Math.floor(o/24);return s<1?"just now":s<60?`${s}m ago`:o<24?`${o}h ago`:a<7?`${a}d ago`:n.toLocaleDateString()}(e.timestamp),this.tooltip=function(e){const n=[`ID: ${e.id}`,`Time: ${new Date(e.timestamp).toLocaleString()}`];return e.name&&n.push(`Name: ${e.name}`),e.userId&&n.push(`User: ${e.userId}`),e.sessionId&&n.push(`Session: ${e.sessionId}`),e.tags.length>0&&n.push(`Tags: ${e.tags.join(", ")}`),n.join("\n")}(e),this.command={command:"langfusecode.viewTrace",title:"View Trace",arguments:[this]}}}n.TraceItem=l;class d extends i.TreeItem{observation;traceId;connectionId;constructor(e,n,t,s){super(e.name||e.id.slice(0,8),s>0?i.TreeItemCollapsibleState.Collapsed:i.TreeItemCollapsibleState.None),this.observation=e,this.traceId=n,this.connectionId=t,this.contextValue="observation",this.iconPath=function(e,n){if("ERROR"===n)return new i.ThemeIcon("error",new i.ThemeColor("errorForeground"));if("WARNING"===n)return new i.ThemeIcon("warning",new i.ThemeColor("editorWarning.foreground"));switch(e){case"GENERATION":return new i.ThemeIcon("sparkle");case"SPAN":return new i.ThemeIcon("symbol-method");case"EVENT":return new i.ThemeIcon("symbol-event");default:return new i.ThemeIcon("circle-outline")}}(e.type,e.level),this.description=function(e){const n=[];if(e.startTime&&e.endTime){const s=new Date(e.endTime).getTime()-new Date(e.startTime).getTime();n.push((t=s)<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`)}var t;return e.model&&n.push(e.model),e.usage?.total&&n.push(`${e.usage.total} tokens`),n.join(" · ")}(e),this.tooltip=function(e){const n=[`Type: ${e.type}`,`ID: ${e.id}`];if(e.name&&n.push(`Name: ${e.name}`),e.model&&n.push(`Model: ${e.model}`),e.usage){const t=[];e.usage.input&&t.push(`in: ${e.usage.input}`),e.usage.output&&t.push(`out: ${e.usage.output}`),t.length&&n.push(`Tokens: ${t.join(", ")}`)}return"DEFAULT"!==e.level&&n.push(`Level: ${e.level}`),n.join("\n")}(e)}}n.ObservationItem=d;class u extends i.TreeItem{connectionId;fromTime;toTime;constructor(e,n,t){super(`Load older traces (${function(e,n){const t=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s=new Date,o=e=>e.toDateString()===s.toDateString();return o(e)&&o(n)?`${t(e)} - ${t(n)}`:`${a=e,a.toLocaleDateString([],{month:"short",day:"numeric"})} ${t(e)}`;var a}(n,t)})`,i.TreeItemCollapsibleState.None),this.connectionId=e,this.fromTime=n,this.toTime=t,this.contextValue="loadOlder",this.iconPath=new i.ThemeIcon("history"),this.command={command:"langfusecode.loadOlderTraces",title:"Load Older",arguments:[e,n,t]}}}n.LoadOlderItem=u;class p extends i.TreeItem{constructor(e,n="info"){super(e,i.TreeItemCollapsibleState.None),this.iconPath=new i.ThemeIcon(n)}}n.MessageItem=p},265(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.activate=async function(e){h=new c.ConnectionManager(e),await h.initialize(),g=new l.LangfuseTreeProvider(h);const n=i.window.createTreeView("langfuseExplorer",{treeDataProvider:g,showCollapseAll:!0});e.subscriptions.push(n),(0,d.registerConnectionCommands)(e,h,g),(0,u.registerTraceCommands)(e,h),(0,p.registerFilterCommands)(e,g),e.subscriptions.push(i.commands.registerCommand("langfusecode.refresh",()=>{g.refresh()}),i.commands.registerCommand("langfusecode.loadOlderTraces",(e,n,t)=>{g.loadOlderTraces(e,n,t)}))},n.deactivate=function(){h?.cleanup()};const i=r(t(398)),c=t(973),l=t(32),d=t(835),u=t(610),p=t(657);let h,g},398(e){e.exports=require("vscode")},610(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.registerTraceCommands=function(e,n){e.subscriptions.push(i.commands.registerCommand("langfusecode.viewTrace",e=>{l.TraceDetailPanel.show(e.connectionId,e.trace,n)}),i.commands.registerCommand("langfusecode.openInBrowser",e=>{const t=n.getConnections().find(n=>n.id===e.connectionId);if(!t)return;let s;if(e instanceof c.TraceItem){const n=e.trace.projectId||"default";s=`${t.url}/project/${n}/traces/${e.trace.id}`}else{const n="default";s=`${t.url}/project/${n}/traces/${e.observation.traceId}?observation=${e.observation.id}`}i.env.openExternal(i.Uri.parse(s))}))};const i=r(t(398)),c=t(185),l=t(18)},618(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LangfuseClient=void 0,n.LangfuseClient=class{baseUrl;authHeader;projectId=null;requestTimeout=6e4;retryOptions={maxRetries:2,baseDelayMs:1e3};constructor(e,n,t){this.baseUrl=e.replace(/\/$/,""),this.authHeader="Basic "+Buffer.from(`${n}:${t}`).toString("base64")}async sleep(e){return new Promise(n=>setTimeout(n,e))}async request(e,n={}){const t=`${this.baseUrl}/api/public${e}`;let s=null;for(let e=0;e<=this.retryOptions.maxRetries;e++){if(e>0){const n=this.retryOptions.baseDelayMs*Math.pow(2,e-1);await this.sleep(n)}const o=new AbortController,a=setTimeout(()=>o.abort(),this.requestTimeout);try{const r=await fetch(t,{...n,signal:o.signal,headers:{Authorization:this.authHeader,"Content-Type":"application/json",Accept:"application/json",...n.headers}});if(clearTimeout(a),500===r.status||502===r.status||503===r.status){const n=await r.text().catch(()=>"Server error");if(s=new Error(`Server error (${r.status}): ${n.slice(0,200)}`),e<this.retryOptions.maxRetries)continue;throw s}if(!r.ok){const e=await r.text().catch(()=>"Unknown error");throw new Error(`Langfuse API error (${r.status}): ${e.slice(0,200)}`)}return r.json()}catch(n){if(clearTimeout(a),n instanceof Error&&"AbortError"===n.name){if(s=new Error(`Request timeout after ${this.requestTimeout/1e3}s - try reducing page size or date range`),e<this.retryOptions.maxRetries)continue;throw s}if(n instanceof Error&&(n.message.includes("fetch")||n.message.includes("network"))&&(s=n,e<this.retryOptions.maxRetries))continue;throw n}}throw s||new Error("Request failed after retries")}async healthCheck(){try{const e=await this.request("/health");return"status"in e||"version"in e}catch{return!1}}async getProjects(){try{return(await this.request("/projects")).data||[]}catch{return[]}}async getProjectId(){if(this.projectId)return this.projectId;const e=await this.getProjects();return e.length>0&&(this.projectId=e[0].id),this.projectId}setProjectId(e){this.projectId=e}async getTraces(e,n=1,t=20){const s=new URLSearchParams;return s.set("page",String(n)),s.set("limit",String(Math.min(t,50))),e?.fromTimestamp&&s.set("fromTimestamp",e.fromTimestamp),e?.toTimestamp&&s.set("toTimestamp",e.toTimestamp),e?.name&&s.set("name",e.name),e?.userId&&s.set("userId",e.userId),e?.sessionId&&s.set("sessionId",e.sessionId),e?.tags&&e.tags.length>0&&e.tags.forEach(e=>s.append("tags",e)),this.request(`/traces?${s.toString()}`)}async getTrace(e){return this.request(`/traces/${e}`)}async getObservations(e,n=1,t=50){const s=new URLSearchParams;return s.set("page",String(n)),s.set("limit",String(Math.min(t,100))),e&&s.set("traceId",e),this.request(`/observations?${s.toString()}`)}async getObservation(e){return this.request(`/observations/${e}`)}getTraceUrl(e){const n=this.projectId?`/project/${this.projectId}`:"";return`${this.baseUrl}${n}/traces/${e}`}}},657(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.registerFilterCommands=function(e,n){e.subscriptions.push(i.commands.registerCommand("langfusecode.searchTraces",async()=>{const e=n.getSearchQuery(),t=await i.window.showInputBox({prompt:"Search traces by name",placeHolder:"Enter trace name to search...",value:e||""});void 0!==t&&n.setSearchQuery(t||void 0)}),i.commands.registerCommand("langfusecode.clearFilters",()=>{n.clearSearch(),i.window.showInformationMessage("Filters cleared")}))};const i=r(t(398))},835(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.registerConnectionCommands=function(e,n,t){e.subscriptions.push(i.commands.registerCommand("langfusecode.addConnection",()=>{c.ConnectionFormPanel.show(e.extensionUri,void 0,async(e,s)=>{await n.addConnection(e,s),t.refresh()})}),i.commands.registerCommand("langfusecode.editConnection",s=>{c.ConnectionFormPanel.show(e.extensionUri,s.config,async(e,s)=>{await n.updateConnection(e,s||void 0),t.refresh()})}),i.commands.registerCommand("langfusecode.deleteConnection",async e=>{"Delete"===await i.window.showWarningMessage(`Delete connection "${e.config.name}"?`,{modal:!0},"Delete")&&(await n.removeConnection(e.config.id),t.refresh())}),i.commands.registerCommand("langfusecode.connect",async e=>{try{await n.connect(e.config.id),t.refresh()}catch(e){i.window.showErrorMessage(`Failed to connect: ${e instanceof Error?e.message:"Unknown error"}`)}}),i.commands.registerCommand("langfusecode.disconnect",e=>{n.disconnect(e.config.id),t.refresh()}),i.commands.registerCommand("langfusecode.refresh",()=>{t.refresh()}))};const i=r(t(398)),c=t(102)},973(e,n,t){var s,o=this&&this.__createBinding||(Object.create?function(e,n,t,s){void 0===s&&(s=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,s,o)}:function(e,n,t,s){void 0===s&&(s=t),e[s]=n[t]}),a=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),r=this&&this.__importStar||(s=function(e){return s=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},s(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=s(e),r=0;r<t.length;r++)"default"!==t[r]&&o(n,e,t[r]);return a(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionManager=void 0;const i=r(t(398)),c=t(143),l=t(618);n.ConnectionManager=class{context;storage;clients=new Map;connectedIds=new Set;_onDidChange=new i.EventEmitter;onDidChange=this._onDidChange.event;constructor(e){this.context=e,this.storage=new c.ConnectionStorage(e)}async initialize(){}getConnections(){return this.storage.getConnections()}async addConnection(e,n){await this.storage.addConnection(e),await this.storage.setSecretKey(e.id,n),this._onDidChange.fire()}async updateConnection(e,n){await this.storage.updateConnection(e),n&&await this.storage.setSecretKey(e.id,n),this.connectedIds.has(e.id)&&(await this.disconnect(e.id),await this.connect(e.id)),this._onDidChange.fire()}async removeConnection(e){await this.disconnect(e),await this.storage.removeConnection(e),await this.storage.deleteSecretKey(e),this._onDidChange.fire()}async connect(e){const n=this.getConnections().find(n=>n.id===e);if(!n)return i.window.showErrorMessage(`Connection not found: ${e}`),!1;const t=await this.storage.getSecretKey(e);return t?i.window.withProgress({location:i.ProgressLocation.Notification,title:`Connecting to ${n.name}...`,cancellable:!1},async()=>{try{const s=new l.LangfuseClient(n.url,n.publicKey,t);return await s.healthCheck()?(this.clients.set(e,s),this.connectedIds.add(e),this._onDidChange.fire(),i.window.showInformationMessage(`Connected to ${n.name}`),!0):(i.window.showErrorMessage(`Failed to connect to ${n.name}: Health check failed`),!1)}catch(e){const t=e instanceof Error?e.message:"Unknown error";return i.window.showErrorMessage(`Failed to connect to ${n.name}: ${t}`),!1}}):(i.window.showErrorMessage("Secret key not found. Please edit the connection."),!1)}async disconnect(e){this.clients.delete(e),this.connectedIds.delete(e),this._onDidChange.fire()}isConnected(e){return this.connectedIds.has(e)}getClient(e){return this.clients.get(e)}getConnectionConfig(e){return this.getConnections().find(n=>n.id===e)}cleanup(){this.clients.clear(),this.connectedIds.clear(),this._onDidChange.dispose()}}}},n={},t=function t(s){var o=n[s];if(void 0!==o)return o.exports;var a=n[s]={exports:{}};return e[s].call(a.exports,a,a.exports,t),a.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map